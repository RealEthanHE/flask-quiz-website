<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“ ç”¨æˆ·æ³¨å†Œ - æ™ºèƒ½å­¦ä¹ ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="main-wrapper">
        <div class="container-box auth-container">
            <h1>ğŸ“ åˆ›å»ºæ–°è´¦æˆ·</h1>
            <p class="subtitle">åŠ å…¥æ™ºèƒ½å­¦ä¹ ç³»ç»Ÿï¼Œå¼€å¯é«˜æ•ˆå­¦ä¹ ä¹‹æ—…</p>
            
            <form id="registerForm">
                <div class="form-group">
                    <label for="username" class="form-label">ğŸ‘¤ ç”¨æˆ·å</label>
                    <input type="text" id="username" name="username" class="form-input" required 
                           placeholder="è¯·è¾“å…¥ç”¨æˆ·åï¼ˆ3-20ä¸ªå­—ç¬¦ï¼‰">
                </div>
                <div class="form-group">
                    <label for="password" class="form-label">ğŸ”’ å¯†ç </label>
                    <input type="password" id="password" name="password" class="form-input" required 
                           placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆè‡³å°‘6ä¸ªå­—ç¬¦ï¼‰">
                </div>
                <div class="form-group">
                    <label for="confirm_password" class="form-label">ğŸ” ç¡®è®¤å¯†ç </label>
                    <input type="password" id="confirm_password" name="confirm_password" class="form-input" required 
                           placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç ">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    ğŸ¯ åˆ›å»ºè´¦æˆ·
                </button>
            </form>
            
            <p style="text-align: center; margin-top: 2rem;">
                å·²æœ‰è´¦æˆ·? <a href="{{ url_for('login_page') }}">ç‚¹æ­¤ç™»å½• â†’</a>
            </p>
            
            <div id="message" class="feedback" style="margin-top: 1rem;"></div>
        </div>
    </div>

<script>
        document.getElementById('registerForm').addEventListener('submit', async function(event) {
            event.preventDefault(); // é˜»æ­¢è¡¨å•é»˜è®¤æäº¤è¡Œä¸º
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const confirm_password = document.getElementById('confirm_password').value;
            const messageDiv = document.getElementById('message');
            
            // æ¸…ç©ºä¹‹å‰çš„æ¶ˆæ¯å¹¶é‡ç½®æ ·å¼ç±»
            messageDiv.textContent = ''; 
            messageDiv.className = 'message-feedback'; // é‡ç½®ä¸ºåŸºç¡€ç±»

            if (password !== confirm_password) {
                messageDiv.textContent = 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´ï¼';
                messageDiv.className = 'message-feedback error'; // è®¾ç½®é”™è¯¯æ ·å¼
                return;
            }

            // å‡†å¤‡è¦å‘é€ç»™åç«¯çš„æ•°æ®
            const formData = {
                username: username,
                password: password
            };

            try {
                // ä½¿ç”¨ url_for ç”Ÿæˆåˆ°åç«¯ API çš„æ­£ç¡® URL, 'register_page' æ˜¯ä½ åœ¨ main.py ä¸­ä¸º /register è·¯ç”±å®šä¹‰çš„å‡½æ•°å
                const response = await fetch("{{ url_for('register_page') }}", { 
                    method: 'POST', 
                    headers: {
                        'Content-Type': 'application/json' 
                    },
                    body: JSON.stringify(formData) 
                });

                const result = await response.json(); 
                messageDiv.textContent = result.message; // å…ˆè®¾ç½®æ–‡æœ¬å†…å®¹

                if (response.ok && response.status === 201) { // 201 Created è¡¨ç¤ºæ³¨å†ŒæˆåŠŸ
                    messageDiv.className = 'message-feedback success'; // è®¾ç½®æˆåŠŸæ ·å¼
                    // æ³¨å†ŒæˆåŠŸåå¯ä»¥æç¤ºç”¨æˆ·å»ç™»å½•ï¼Œæˆ–è€…ç›´æ¥è·³è½¬
                    setTimeout(() => { window.location.href = "{{ url_for('login_page') }}"; }, 2000);
                } else { 
                    messageDiv.className = 'message-feedback error'; // è®¾ç½®é”™è¯¯æ ·å¼
                }
            } catch (error) {
                console.error('æ³¨å†Œè¯·æ±‚å‡ºé”™:', error);
                messageDiv.textContent = 'æ³¨å†Œè¯·æ±‚å‡ºé”™ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥ã€‚';
                messageDiv.className = 'message-feedback error'; // ç½‘ç»œé”™è¯¯ä¹Ÿç”¨é”™è¯¯æ ·å¼
            }
        });
    </script>
</body>
</html>